= Introduction √† la Culture DevOps : Briser le Mur
:toc: macro
:toc-title: Sommaire
:icons: font
:imagesdir: ./images

// Introduction pour le prof : Ce cours est con√ßu pour √™tre projet√© et discut√© en 20 minutes, suivi d'un TD de r√©flexion.

toc::[]

== üéì Partie 1 : Le Mini-Cours

=== 1. Le Probl√®me : "Le Mur de la Confusion"

Avant le DevOps, le monde de l'informatique √©tait divis√© en deux tribus ennemies.

* **Les DEVs (D√©veloppeurs - Futurs SLAM)** :
** üéØ *Leur but* : Cr√©er de la valeur, ajouter des fonctionnalit√©s, coder vite.
** üó£Ô∏è *Leur devise* : "Le changement, c'est la vie !".
** üõ†Ô∏è *Leur outil* : VS Code, Git.

* **Les OPS (Op√©rations / SysAdmin - Futurs SISR)** :
** üéØ *Leur but* : La stabilit√©, la s√©curit√©, la disponibilit√© (Uptime).
** üó£Ô∏è *Leur devise* : "Le changement, c'est le risque !".
** üõ†Ô∏è *Leur outil* : SSH, Linux, Firewall.


// Suggestion d'image : Un mur de briques avec des Devs d'un c√¥t√© jetant du code par-dessus, et des Ops de l'autre c√¥t√© qui paniquent avec des serveurs en feu.

**Le sc√©nario catastrophe classique :**

1. Le Dev code une super fonctionnalit√© sur sa machine (`localhost`).
2. "√áa marche sur ma machine !", dit-il.
3. Il envoie le code par ZIP ou FTP √† l'Ops.
4. L'Ops d√©ploie sur le serveur de production.
5. **BOUM !** Le site plante. (Version de PHP diff√©rente, librairie manquante, config BDD fausse).
6. L'Ops accuse le Dev ("Ton code est pourri"). Le Dev accuse l'Ops ("Ton serveur est mal configur√©").

=== 2. La Solution : DevOps (Development + Operations)

Le DevOps n'est pas un m√©tier, ni un outil. C'est une **culture**.
C'est l'id√©e de **casser le mur** pour que Devs et Ops travaillent ensemble tout au long du cycle de vie de l'application.

* **Le Dev** se soucie de savoir o√π son code va tourner (Docker, Config).
* **L'Ops** automatise le d√©ploiement pour que le Dev puisse livrer souvent sans tout casser.

=== 3. Le Cycle Infini (The Infinity Loop)

Le DevOps est repr√©sent√© par un symbole infini, montrant que le travail ne s'arr√™te jamais.


// Suggestion d'image : Le diagramme infini classique avec les √©tapes Plan, Code, Build, Test (Dev) et Release, Deploy, Operate, Monitor (Ops).

. **PLAN** : On d√©finit ce qu'on va faire (Jira, Trello).
. **CODE** : On √©crit le code (VS Code, Git).
. **BUILD** : On assemble le code (Composer, compilation).
. **TEST** : On v√©rifie automatiquement que rien n'est cass√©.
. **RELEASE** : On pr√©pare la version.
. **DEPLOY** : On met en ligne (ce que vous avez fait sur AlwaysData).
. **OPERATE** : Le serveur tourne (Linux, Apache).
. **MONITOR** : On surveille les logs et les erreurs (SISR).

=== 4. Les 3 piliers techniques (CI/CD)

Pour r√©ussir cela, on utilise l'automatisation :

1.  **CI (Continuous Integration)** :
* √Ä chaque fois qu'un Dev fait `git push`, un robot lance les tests.
* Si √ßa plante üî¥, le code est refus√©.

2.  **CD (Continuous Deployment)** :
* Si les tests passent üü¢, le robot d√©ploie automatiquement le site sur le serveur.
* Plus besoin de se connecter en SSH √† la main !

3.  **IaC (Infrastructure as Code)** :
* On ne configure plus le serveur √† la souris.
* On √©crit la config du serveur dans un fichier texte (comme votre `.htaccess` ou un `Dockerfile`).

---

== üìù Partie 2 : TD - Analyse de notre D√©ploiement (1 Heure)

*Objectif : Relier notre TP pratique (AlwaysData) aux concepts th√©oriques du DevOps.*

=== Exercice 1 : Cartographie de vos outils

Vous venez de d√©ployer votre application. Classez les outils et actions que vous avez utilis√©s dans les cases "Dev" ou "Ops" (ou les deux).

|===
| Outil / Action | Est-ce DEV (SLAM) ? | Est-ce OPS (SISR) ? | Pourquoi ?

| VS Code
| ‚úÖ
|
| Cr√©ation du code source

| `git commit`
|
|
|

| Cr√©ation BDD MySQL (Interface)
|
|
|

| `ssh user@serveur`
|
|
|

| Lecture des logs d'erreur
|
|
|

| Fichier `database.php` avec `getenv()`
|
|
| Pont entre le code et le serveur

|===

=== Exercice 2 : Le concept des "Variables d'Environnement"

Dans le TP, nous avons remplac√© :
`$pass = ""` (Code en dur)
Par :
`$pass = getenv('DB_PASS')` (Variable d'environnement)

**Questions :**

1.  **S√©curit√© :** Si un hacker vole votre code source sur GitHub demain, a-t-il le mot de passe de votre base de donn√©es de production ? Pourquoi ?
2.  **Portabilit√© :** Imaginez que l'entreprise grandit. On ach√®te un 2√®me serveur pour tester ("Staging") avant la production.
* Avez-vous besoin de modifier le code `database.php` pour le d√©ployer sur ce serveur de test ?
* Que devez-vous changer uniquement ?

=== Exercice 3 : Sc√©nario "Crash" (Collaboration SISR/SLAM)

C'est lundi matin. Vous avez d√©ploy√© la nouvelle version de l'application vendredi soir.
Ce matin, le directeur appelle : *"Erreur 500 ! Le site est blanc ! Je perds de l'argent !"*

**Simulez la r√©solution de crise DevOps :**

1.  **Le r√©flexe OPS (SISR) :** Quelle est la toute premi√®re chose √† faire ? (Indice : Ce n'est pas "Changer le code").
* _R√©ponse attendue : Regarder les LOGS (`/var/log/apache2/error.log` ou console AlwaysData)._

2.  **L'analyse :** Les logs disent : `PDOException: SQLSTATE[HY000] [1045] Access denied for user`.
* D'o√π vient le probl√®me ? (Code ou Config ?)
* Qui doit intervenir ?

3.  **L'analyse (Cas 2) :** Les logs disent : `Parse error: syntax error, unexpected '}' in index.php on line 42`.
* D'o√π vient le probl√®me ?
* Comment est-ce possible que √ßa ait march√© sur le PC du d√©veloppeur avant ?
* Quelle √©tape du "Cycle Infini" a manqu√© ici ? (Indice : Entre CODE et DEPLOY).

=== Exercice 4 : Vers l'Automatisation (Bonus)

Vous avez tap√© ces commandes √† la main pour d√©ployer :
[source,bash]
----
ssh monuser@serveur
cd www
git pull origin master
----

Imaginez que vous devez faire cela 10 fois par jour. C'est lent et risqu√© (erreur de frappe).
√âcrivez en pseudo-code ce que devrait faire un "Robot de d√©ploiement" (GitHub Action) √† chaque fois que vous faites un Push.

* *√âv√©nement d√©clencheur* : ...
* *Action 1* : Se connecter √† ...
* *Action 2* : ...
* *Action 3* : ...
* *Notification* : Envoyer un mail √† ...

== üéØ Conclusion

Que vous choisissiez **SISR** ou **SLAM** l'an prochain :

* Le **SISR** devra savoir lire du code (PHP/SQL) pour comprendre pourquoi un serveur plante.
* Le **SLAM** devra savoir utiliser SSH et les variables d'environnement pour que son code soit d√©ployable.

**Le DevOps, c'est la fin du "√áa marche sur ma machine".**