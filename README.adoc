= Projet : Application d'Inscription S√©curis√©e (PHP MVC & Crypto)
:toc: macro
:toc-title: Sommaire

Ce projet est un exercice complet de d√©veloppement web s√©curis√©. Il part d'une application PHP MVC simple pour aboutir √† une architecture complexe int√©grant du chiffrement hybride et une gestion de version professionnelle via SSH.

toc::[]

== üéØ Contexte

Vous √™tes missionn√© par l'ENC pour d√©velopper le module d'inscription finale des nouveaux √©tudiants apr√®s Parcoursup.
L'application doit g√©rer :

* L'inscription et l'authentification des √©tudiants.
* La protection des mots de passe (Hachage).
* La confidentialit√© des donn√©es administratives (Chiffrement Sym√©trique).
* La confidentialit√© stricte des documents m√©dicaux (Chiffrement Hybride).

== üìö Objectifs P√©dagogiques

√Ä la fin de ce cycle de TPs, vous √™tes sensibilis√© √† :

. **Architecture** : Structure MVC, s√©paration logique/donn√©es/vue.
. **S√©curit√© Web** : Diff√©rence entre Hachage (MDP) et Chiffrement (Donn√©es).
. **Cryptographie** :
** Sym√©trique (AES-256) pour les donn√©es textuelles.
** Hybride (AES + RSA) pour les fichiers volumineux.
. **Authentification** : Gestion des Sessions et des R√¥les (Admin, √âtudiant, Infirmi√®re).
. **DevOps** : Utilisation de cl√©s SSH pour l'authentification Git.

== üõ†Ô∏è Pr√©requis

* Serveur Web (Apache/Nginx) avec PHP 8+.
* Base de donn√©es MySQL/MariaDB.
* Extension PHP `openssl` activ√©e.
* Client Git.

== üìÇ Structure du Projet

[source,text]
----
/tp_enc_mvc/
|
|-- id_rsa_infirmerie          # üîë Cl√© Priv√©e (Sert √† d√©chiffrer - Simule le poste Infirmi√®re)
|-- id_rsa_infirmerie.pub      # üîë Cl√© Publique (Format SSH - Pour Git/Github)
|-- id_rsa_infirmerie_php.pem  # üîë Cl√© Publique (Format PEM - Convertie pour PHP OpenSSL)
|-- setup_keys.php             # üõ†Ô∏è Script pour g√©n√©rer/convertir les cl√©s.
|
|-- index.php                  # Contr√¥leur Frontal (Routeur)
|
|-- controller/
|   |-- etudiantController.php # G√®re Inscription, Auth, Dashboards (Admin/Infirmi√®re).
|
|-- model/
|   |-- database.php           # Connexion BDD (PDO).
|   |-- etudiantModel.php      # CRUD √âtudiant + Documents Sant√© (BLOBs).
|
|-- services/                  # COUCHE CRYPTO
|   |-- CryptoService.php      # Contient : encryptData (AES) & chiffreFichier (Hybride).
|
|-- view/
|   |-- formulaireInscription.php
|   |-- adminDashboard.php     # Vue Admin (Donn√©es d√©chiffr√©es).
|   |-- infirmiereDashboard.php # Vue Infirmi√®re (T√©l√©chargement s√©curis√©).
|   ...
----

== üöÄ Historique des TPs

=== TP 1-3 : Les Fondations MVC & Auth
* Mise en place du **Mod√®le-Vue-Contr√¥leur**.
* S√©curisation des mots de passe avec `password_hash()` et `password_verify()`.

=== TP 4 : Confidentialit√© des Donn√©es (Sym√©trique)
* **Objectif :** Prot√©ger le "Num√©ro de Dossier".
* **M√©thode :** Chiffrement AES-256-CBC via `CryptoService`.
* **R√®gle m√©tier :** Seul l'administrateur peut voir le num√©ro d√©chiffr√©. L'√©tudiant voit `[ACC√àS REFUS√â]`.

=== TP 5 : Documents M√©dicaux & Git (Hybride & SSH)
Ce TP couvre deux aspects majeurs utilisant la m√™me paire de cl√©s RSA.

==== A. Le Chiffrement Hybride (Module Infirmerie)
Pour s√©curiser les fichiers PDF (trop gros pour RSA seul) :
1.  G√©n√©ration d'une **cl√© AES unique** (session).
2.  Chiffrement du fichier avec cette cl√© AES.
3.  Chiffrement de la cl√© AES avec la **Cl√© Publique RSA** de l'infirmerie.
4.  Stockage du tout (Blob chiffr√© + Cl√© chiffr√©e + IV) en base de donn√©es.

==== B. Authentification Git via SSH
Nous utilisons la **Cl√© Priv√©e** de l'infirmi√®re pour nous authentifier sur GitHub/GitLab, prouvant que la cryptographie asym√©trique sert √† la fois √† la confidentialit√© et √† l'authenticit√©.

== üß† Sch√©ma de Synth√®se : Le Double Usage RSA

Ce sch√©ma illustre comment la m√™me paire de cl√©s est utilis√©e pour deux objectifs de s√©curit√© oppos√©s dans nos TPs.

[source,text]
----
       UTILISATION DE LA PAIRE DE CL√âS RSA (INFIRMERIE)
       ================================================

   [ CONTEXTE 1 : Confidentialit√© ]           [ CONTEXTE 2 : Authenticit√© ]
      (TP PHP / Donn√©es M√©dicales)                  (TP GIT / SSH)
                 ‚îÇ                                        ‚îÇ
                 ‚ñº                                        ‚ñº
    +-------------------------+              +-------------------------+
    |   Donn√©e Sensible       |              |   Connexion Serveur     |
    |      (Fichier PDF)      |              |    (Github / Gitlab)    |
    +-----------+-------------+              +------------+------------+
                ‚îÇ                                         ‚îÇ
                ‚îÇ Chiffrement                             ‚îÇ Signature
                ‚îÇ (Cadenas)                               ‚îÇ (Sceau)
                ‚ñº                                         ‚ñº
      +-------------------+                     +-------------------+
      |   CL√â PUBLIQUE    |                     |    CL√â PRIV√âE     |
      | (id_rsa_inf.pub)  |                     | (id_rsa_infirmerie)|
      +-------------------+                     +-------------------+
                ‚îÇ                                         ‚îÇ
    "N'importe qui peut fermer                "Seul le propri√©taire
     le cadenas (chiffrer),                    peut apposer son sceau
     seul le priv√© l'ouvre."                   (prouver son identit√©)."
----

== üíª Commandes Utiles

=== G√©n√©ration des cl√©s (Si script non dispo)
[source,bash]
----
# G√©n√©ration de la cl√© priv√©e (Format PEM pour PHP)
ssh-keygen -t rsa -b 4096 -m PEM -f id_rsa_infirmerie -N ""

# Conversion de la cl√© publique pour PHP (Format PEM)
ssh-keygen -f id_rsa_infirmerie.pub -e -m PEM > id_rsa_infirmerie_php.pem
----

=== Configuration Git locale
Pour utiliser la cl√© du TP uniquement sur ce projet :
[source,bash]
----
git config core.sshCommand "ssh -i ./id_rsa_infirmerie -F /dev/null"
----

== ‚ö†Ô∏è Avertissement de S√©curit√©

Dans ce TP p√©dagogique, nous utilisons la m√™me cl√© pour signer nos commits et chiffrer des donn√©es.
**Dans un environnement de production :**

. Ne jamais commiter de cl√©s priv√©es dans le d√©p√¥t.
. S√©parer les cl√©s d'usage (une cl√© pour le code, une cl√© pour les donn√©es).
. Stocker les cl√©s priv√©es sensibles sur des supports s√©curis√©s (HSM, Vault, SmartCard).